<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Detail Mesin</title>
        <link rel="stylesheet" href="{{ url_for('static',filename='css/styles.css')}}"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
        <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">-->
        <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
        /* Font */
        body {
          font-family: 'Poppins', sans-serif;
          margin: 0;
          padding: 0;
          background-color: #f3f4f6;
          color: #333;
          line-height: 1.6;
        }

        /* Main Container */
        .main-container {
          padding: 30px;

        }

        /* Header */
        .header {
          background-color: var(--Hijau-Taro);
          color: white;
          padding: 25px;
          border-radius: 12px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          margin-top: 0;
          height: 80px;
          transition: margin-left 0.4s ease;
        }

        /* Section Box */
        .section-box {
          background-color: #fff;
          margin-top: 25px;
          padding: 20px 25px;
          border-radius: 12px;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .section-box:hover {
          transform: translateY(-3px);
          box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
        }
        /* Tab Button Style */
        .maintenance-table {
          display: flex;
          gap: 10px;
          margin-bottom: 15px;
        }

        .maintenance-table .tab {
          background-color: #eee;
          border: none;
          padding: 10px 20px;
          border-radius: 25px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
        }

        .maintenance-table .tab:hover {
          background-color: #ddd;
        }

        .maintenance-table .tab.active {
          background-color: #007bff;
          color: white;
        }

        /* Konten tab */
        .category-content {
          display: none;
          animation: fadeIn 0.3s ease-in-out;
        }

        .category-content.active {
          display: block;
        }

        /* Fade Animation */
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

        /* Table Styling */
        .table {
          width: 100%;
          border-collapse: collapse;
          font-size: 0.95rem;
        }

        .table th, .table td {
          padding: 12px 15px;
          border: 1px solid #ddd;
          text-align: left;
        }

        .table th {
          background-color: #f1f1f1;
          font-weight: 600;
        }

        .table-striped tbody tr:nth-child(odd) {
          background-color: #fafafa;
        }

        /* Tombol umum */
        .btn {
          border: none;
          padding: 8px 16px;
          border-radius: 8px;
          font-weight: 500;
          cursor: pointer;
          transition: background 0.2s ease;
        }

        .btn-success {
          background-color: #28a745;
          color: white;
        }

        .btn-success:hover {
          background-color: #218838;
        }

        .btn-primary {
          background-color: #007bff;
          color: white;
        }

        .btn-primary:hover {
          background-color: #0069d9;
        }

        .btn-secondary {
          background-color: #6c757d;
          color: white;
        }

        .btn-secondary:hover {
          background-color: #5a6268;
        }

        /* Responsive img */
        img {
          max-width: 100%;
          height: 300px;
        }

        /* Utility */
        .float-end {
          float: right;
        }

        .text-center {
          text-align: center;
        }

        .mt-2 {
          margin-top: 0.5rem;
        }

        .mt-3 {
          margin-top: 1rem;
        }

        .mt-4 {
          margin-top: 1.5rem;
        }
        .table-responsive{
            width: 100%;
            overflow-x: auto;
            overflow-y:auto;
            height:auto;
            max-height: 500px;
            white-space: nowrap;
        }
          .table-responsive table thead th {
              position: sticky;
              top: 0;
              background-color: #3498db;
          }
    @media (max-width: 768px) {
          .main-container {
            margin-left: 0;
              padding: 60px 10px 10px;
          }

          .header {
            position: relative;
            margin: 2px; /* Sama seperti .section-box */
              width: auto; /* Tidak memaksakan full width */
              padding: 15px; /* Disamakan juga padding-nya */
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            top: 0;
            left: 0;
            z-index: 1;

             /* Tambahan untuk center text */
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
          }

          .section-box {
            padding: 15px;
            margin: 10px;
          }
          img {
          max-width: 100%;
          height: auto;
        }
          .btn-success {
              width: auto;
              text-align: center;
          background-color: #28a745;
          color: white;
        }
        }
</style>
</head>
<body>
    <!-- Mobile Sidebar Menu Button -->
    <button class="sidebar-menu-button">
      <span class="material-symbols-rounded">menu</span>
    </button>
    <!-- Sidebar -->
    <aside class="sidebar">
      <!-- Sidebar Header -->
      <header class="sidebar-header">
        <a href="{{url_for('dashboard')}}" class="header-logo">
          <img src="{{url_for('static', filename='image/Taro.png')}}" alt="Logo" />
        </a>
        <button class="sidebar-toggler">
          <span class="material-symbols-rounded">chevron_left</span>
        </button>
        <button class="toggler menu-toggler">
          <span class="material-symbols-rounded">menu</span>
        </button>
      </header>
      <nav class="sidebar-nav">
        <!-- Primary Top Nav -->
        <ul class="nav-list primary-nav">
            {% if role == "maintenance" or role=="admin" %}

            <!--Dashboard-->
          <li class="nav-item">
            <a href="{{url_for('dashboard')}}" class="nav-link">
              <span class="material-symbols-rounded">dashboard</span>
              <span class="nav-label">Dashboard</span>
            </a>
            <ul class="dropdown-menu">
              <li class="nav-item"><a class="nav-link dropdown-title">Dashboard</a></li>
            </ul>
          </li>

          <!-- Preventive Maintenance -->
          <li class="nav-item dropdown-container">
            <a href="{{url_for('pm')}}" class="nav-link dropdown-toggle">
              <span class="material-symbols-rounded">calendar_today</span>
              <span class="nav-label">Preventive Maintenance</span>
              <span class="dropdown-icon material-symbols-rounded">keyboard_arrow_down</span>
            </a>
            <!-- Dropdown Menu -->
            <ul class="dropdown-menu">
              <li class="nav-item"><a class="nav-link dropdown-title">Preventive Maintenance</a></li>
              <li class="nav-item"><a href="{{url_for('historyPM')}}" class="nav-link dropdown-link">History Maintenance</a></li>
              <li class="nav-item"><a href="{{url_for('pm')}}" class="nav-link dropdown-link">Plan Maintenance</a></li>
              <li class="nav-item"><a href="{{url_for('sparepart')}}" class="nav-link dropdown-link">Sparepart</a></li>
            </ul>
          </li>

          <!-- Corrective Maintenance -->
          <li class="nav-item dropdown-container">
            <a href="{{url_for('correctiveMaintenance')}}" class="nav-link dropdown-toggle">
              <span class="material-symbols-rounded">star</span>
              <span class="nav-label">Corrective Maintenance</span>
              <span class="dropdown-icon material-symbols-rounded">keyboard_arrow_down</span>
            </a>
            <!-- Dropdown Menu -->
            <ul class="dropdown-menu">
              <li class="nav-item"><a class="nav-link dropdown-title">Corrective Maintenance</a></li>
              <li class="nav-item"><a href="{{url_for('historyCorrectiveMaintenance')}}" class="nav-link dropdown-link">Report</a></li>
              <li class="nav-item"><a href="{{url_for('correctiveMaintenance')}}" class="nav-link dropdown-link">Input</a></li>
            </ul>
          </li>

            <!--Scanner-->
          <li class="nav-item">
            <a href="{{url_for('scanner')}}" class="nav-link">
              <span class="material-symbols-rounded">notifications</span>
              <span class="nav-label">Scanner</span>
            </a>
            <ul class="dropdown-menu">
              <li class="nav-item"><a class="nav-link dropdown-title">Scanner</a></li>
            </ul>
          </li>

          {% endif %}

            <!--Detail Mesin-->
          <li class="nav-item">
            <a href="{{url_for('machine')}}" class="nav-link">
              <span class="material-symbols-rounded">local_library</span>
              <span class="nav-label">Detail Mesin</span>
            </a>
            <ul class="dropdown-menu">
              <li class="nav-item"><a class="nav-link dropdown-title">Detail Mesin</a></li>
            </ul>
          </li>

            <!--LogOut-->
          <li class="nav-item">
            <a href="{{ url_for('logout') }}" class="nav-link">
              <span class="material-symbols-rounded">logout</span>
              <span class="nav-label">Sign Out</span>
            </a>
            <ul class="dropdown-menu">
              <li class="nav-item"><a href="{{ url_for('logout') }}" class="nav-link dropdown-title">Sign Out</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </aside>
    <!-- Main Container -->
    <div class="main-container">
        <div class="header text-center fade-in-scroll">
            <h2>Detail Mesin</h2>
          </div>

      <!-- Section: Detail Mesin -->
      <div class="section-box">
        <h2>Detail Mesin</h2>
        <div class="row">
          <!-- Informasi Mesin -->
          <div class="col-9">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <tr><th>ID Mesin</th><td>{{ data.id }}</td></tr>
                    <tr><th>Nama Mesin</th><td>{{ data.nama }}</td></tr>
                    <tr><th>Jenis Mesin</th><td>{{ data.tipe_mesin }}</td></tr>
                    <tr>
                        <th>Tipe PLC</th>
                        <td>{{ data.tipe_plc }}
                            {% if role in ["maintenance", "master"] %}
                                <a href="backup/{{data.id}}" class="btn btn-success float-end btn-sm">Backup</a>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Tipe HMI</th>
                        <td>{{ data.tipe_hmi }}
                            {% if role in ["maintenance", "master"] %}
                                <a href="backup/{{data.id}}" class="btn btn-success float-end btn-sm">Backup</a>
                            {% endif %}
                        </td>
                    </tr>
                    <tr><th>Line</th><td>{{ data.line }}</td></tr>
                    <tr><th>Manufacturer</th><td>{{data.manufacturer}}</td></tr>
                    <tr><th>Speed</th><td>{{data.speed}}</td></tr>
                    <tr><th>Kapasitas Produksi</th><td>{{data.capacity}}</td></tr>
                    <tr><th>Tahun Mesin</th><td>{{data.year}}</td></tr>
                </table>
            </div>
              <br>
            {% if role == "maintenance" %}
              <a href="update/{{data.id}}" class="btn btn-primary">Edit Info Mesin</a>
            {% endif %}
          </div>

          <!-- Gambar & Tombol -->
          <div class="col-3 text-center">
            <img src="{{url_for('static', filename='image/' + data.tipe_mesin +'.png') }}" alt="{{data.tipe_mesin}}" height="25px">
            <br>
              <b>{{data.nama}} L{{data.line}}</b>
            <br>
              <br>
              {% if role in ["maintenance", "master"] %}
              <a href="sparepart/{{data.id}}" class="btn btn-success mt-2">Detail Sparepart</a>
              {% endif %}
          </div>
        </div>
      </div>

      <!-- Section: Jadwal Maintenance -->
      {% if role in ["maintenance", "master"] %}
      <div class="section-box">
        <h3>Jadwal Maintenance</h3>

        <!-- Tab Switcher -->
        <div class="maintenance-table mb-3">
          <button class="tab active" onclick="showCategory('next_maintenance', this)">Next Maintenance</button>
          <button class="tab" onclick="showCategory('history_maintenance', this)">History Maintenance</button>
        </div>

        <!-- Next Maintenance -->
        <div id="next_maintenance" class="category-content active">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Tipe PM</th>
                        <th>Sparepart</th>
                        <th>Qty</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for pm in data.next_maintenance %}
                        <tr>
                            <td>{{ pm[0] }}</td>
                            <td>{{ pm[1] }}</td>
                            <td>{{ pm[2] }}</td>
                            <td>{{ pm[3] }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- History Maintenance -->
        <div id="history_maintenance" class="category-content" >
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Tipe PM</th>
                        <th>Sparepart</th>
                        <th>Qty</th>
                        <th>Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for pm in data.maintenance_history %}
                        <tr>
                            <td>{{ pm[0] }}</td>
                            <td>{{ pm[1] }}</td>
                            <td>{{ pm[2] }}</td>
                            <td>{{ pm[3] }}</td>
                            <td>Done</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
      </div>
      {% endif %}

    {% if role == "maintenance" %}
      <!-- Section: QR Code & Tombol Kembali
            note:role khusus untuk master-->
      <div class="section-box text-center">
        <h3>QR Code</h3>

          <img src="data:image/png;base64,{{ qr }}" alt="QR Code">

      </div>
    {% endif %}
        <div class="section-box text-center">
            <a href="{{ url_for('machine') }}" class="btn btn-secondary mt-3">Kembali</a>
        </div>
    </div>


    <script src="{{ url_for('static', filename ='js/scripts.js') }}"></script>
    <script>
        function showCategory(category, element) {
            document.querySelectorAll('.category-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));

            document.getElementById(category).classList.add('active');
            element.classList.add('active');
        }
    </script>
</body>
</html>
